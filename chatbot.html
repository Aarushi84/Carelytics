<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CARELYTICS Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background:#f4f9ff; margin:0; padding:0; }
    h2 { text-align:center; padding:15px; color:#067bc2; }
    #chat-container {
      max-width:600px; margin:0 auto; background:white; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:20px; height:70vh;
      display:flex; flex-direction:column;
    }
    #messages { flex:1; overflow-y:auto; margin-bottom:10px; padding-right:10px; }
    .msg { padding:10px; margin:8px 0; border-radius:10px; max-width:80%; line-height:1.4; }
    .user { background:#d1e7ff; align-self:flex-end; }
    .bot { background:#f1f1f1; align-self:flex-start; white-space:pre-wrap; }
    #input-container { display:flex; gap:8px; }
    #userInput { flex:1; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:15px; }
    button { padding:12px 18px; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
    #sendBtn { background:#067bc2; color:white; }
    #sendBtn:hover { background:#055a92; }
  </style>
</head>
<body>
  <h2>ðŸ¤– CARELYTICS Chatbot</h2>
  <div id="chat-container">
    <div id="messages"></div>
    <div id="input-container">
      <input type="text" id="userInput" placeholder="Ask me anything about your health...">
      <button id="sendBtn" onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    function addMessage(text, sender){
      const msg = document.createElement("div");
      msg.className = "msg " + sender;
      msg.innerHTML = text;
      document.getElementById("messages").appendChild(msg);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    }

    async function sendMessage(){
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if(!text) return;
      addMessage("ðŸ™‹ " + text, "user");
      input.value = "";

      // fetch latest record from localStorage
      const records = JSON.parse(localStorage.getItem("healthRecords")) || [];
      const latest = records.length ? records[records.length - 1] : {};

      // send to backend
      const res = await fetch("http://localhost:3000/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text, healthData: latest })
      });

      const data = await res.json();
      addMessage("ðŸ¤– " + data.reply, "bot");
    }
  </script>
</body>
</html>
